<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/template/templateCandidates.xhtml">

	<ui:define name="xxhrwjs">
		<script type="text/javascript">
			function handleUpdateRequest(xhr, status, args) {
				if (args.validationFailed || !args.updateIn) {
					argsValidationFailed();
				}
			}
		</script>
	</ui:define>


	<ui:define name="xxhrwcss">
		<style type="text/css">
.xXwrongAnswer {
	background-color: #ffe6e6;
	text-align: left;
	border: 3px solid red;
	color: red;
	font-size: 30px;
}

.xXcorrectAnswer {
	background-color: #e6ffe6;
	text-align: left;
	border: 3px solid green;
	color: green;
	font-size: 30px;
}

.xXinstructions {
	background-color: #fff;
	color: black;
	font-size: 20px;
}

.xXscores {
	margin-top: 10px;
	margin-bottom: 10px;
	background: #f9f9f9;;
	border: 1px solid #ccc;
	font-weight: bold;
}

.green-button.ui-button.ui-state-default {
	background-color: #5cb85c;
	border-color: #5cb85c;
	color: #fff;
}

.green-button.ui-button.ui-state-default:enabled:hover, .green-button.ui-button.ui-state-default:focus
	{
	background-color: #4cae4c;
	border-color: #5cb85c;
}

.red-button.ui-button.ui-state-default {
	background-color: #d9534f;
	border-color: #d9534f;
	color: #fff;
}

.red-button.ui-button.ui-state-default:enabled:hover, .red-button.ui-button.ui-state-default:focus
	{
	background-color: #d43f3a;
	border-color: #d9534f;
	}

</style>


<script type="text/javascript">
	var previewDicom = {
			reload : function(key){
				//debugger;
				var frame = $('#dcmpreview');
				frame.attr('src', '/CmriSeWeb/resources/dicom-viewer/stable/index.jsp?dcmkey='+key);
			}
	}
</script>


	</ui:define>
	<ui:define name="content">
	<script type="text/javascript">
	var previewDicom = {
			reload : function(key){
				//debugger;
				var frame = $('#dcmpreview');
				frame.attr('src', '/CmriSeWeb/resources/dicom-viewer/stable/index.jsp?dcmkey='+key);
			}
	}
</script>
		<h1>Previsualización Caso Clínico</h1>
		<h:form id="coreCaseForm">
			<div class="ui-g">
				<!--  <div class="ui-g-12 ui-md-3"> -->
				<!--    <div class="ui-g-12 ui-md-12" style="background-color: #4a4058;color: #fff;"> -->
				<!--      <div class="ui-g-12" > -->
				<!--      <h3>Pregunta</h3> -->
				<!--     </div> -->
				<!--    </div> -->
				<!--    <div class="ui-g-12 ui-md-12" style="background-color: rgba(0, 0, 0, 0.3);color: #fff;"> -->
				<!--    </div>   -->
				<!--    <div class="ui-g-12 ui-md-12" style="background-color: rgba(0, 0, 0, 0.3);color: #fff;"> -->
				<!--     <h1>Tabla de Contenidos</h1> -->
				<!--    </div> -->
				<!--    <div class="ui-g-12 ui-md-12" style="background-color: #343633;color: #fff;"> -->
				<!--     <h3>#{coreCasePreviewForm.ccHdrV1.nombre}</h3> -->
				<!--      <ui:repeat var="preguntas" value="#{coreCasePreviewForm.listCcPreguntasHdrV1}"> -->
				<!--      <h3 style="margin-left: 30px">#{preguntas.titulo}</h3> -->
				<!--     </ui:repeat> -->
				<!--    </div> -->
				<!--  </div> -->


				<div class="ui-g-12 ui-md-12 ui-g-nopad">
					<div class="ui-g-12 ui-md-12">
						<div class="ui-g-12 ui-md-12">	
						<div class="ui-g-12 ui-md-12">
							<h2>#{coreCasePreviewForm.ccPreguntasFtaV1.tituloPregunta}?</h2>
							</div>
							<h4>(#{coreCasePreviewForm.ccPreguntasFtaV1.textoSugerencias})</h4>
							


							<!--   
           <ui:repeat var="imagenesGrupo" value="#{coreCasePreviewForm.listPresentCcImagenesGrp}" varStatus="status">
		      <div class="ui-g-12 ui-md-12">
		       <h3>#{imagenesGrupo.tituloSuperior}</h3>
		      </div>
		      <div class="ui-g-12 ui-md-12">
		       <ui:repeat var="imagenes" value="#{imagenesGrupo.listCcImagenes}" varStatus="status">
		         <h:graphicImage value="data:image/jpg;base64,#{imagenes.jpgBase64}" style="max-width: 300px; max-height: 300px;" />
		       </ui:repeat>
		      </div>
		    </ui:repeat>
		    

							<ui:repeat var="imagenesGrupo"
								value="#{coreCasePreviewForm.listPresentCcImagenesGrp}"
								varStatus="status">
								<div class="ui-g-12 ui-md-12">
									<p:galleria value="#{imagenesGrupo.listCcImagenes}" var="image"
										panelWidth="400" panelHeight="400" showFilmstrip="true"
										transitionInterval="1000">
										<p:graphicImage value="#{image.jpgStreamedContent}"
											stream="false" style="max-width: 100%; max-height: 100%;"
											alt="#{image.nombreImagen}" title="#{image.nombreImagen}" />
									</p:galleria>
								</div>
							</ui:repeat>
							
			-->				
							
							<h1>#{coreCasePreviewForm.ccPreguntasFtaV1.tituloPregunta}?</h1>
							<h3>(#{coreCasePreviewForm.ccPreguntasFtaV1.textoSugerencias})</h3>
							
							
							
							
						<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.listPresentQCcImagenesGrp.size() > 0}">	
						<div class="card">

							<section>
								<fieldset>
									<legend>DICOM Series</legend>
									<div class="ui-g-4" >		
										 <p:dataTable var="imagenesGrupo"  value="#{coreCasePreviewForm.listPresentQCcImagenesGrp}" 
										 	scrollable="true" scrollHeight="420">
			    
										  <p:column headerText="Series Title" style="text-align: left;">
												<div class="ui-g-12" >		            	 	
													<h:outputText value="#{imagenesGrupo.tituloSuperior}" />
												</div>
												 <p:scrollPanel style="width:100%; height:110px">
												
													<ui:repeat var="imagenes"
														value="#{imagenesGrupo.listCcImagenes}" varStatus="status">
														<h:graphicImage
															value="data:image/jpg;base64,#{imagenes.thumbailBase64}"
															style="max-width: 250px; max-height: 300px; padding: 2px;"
															onclick="previewDicom.reload('#{imagenes.dcmKey}')" 
															alt="#{imagenes.nombreImagen}" title="#{imagenes.nombreImagen}"
															/>
													</ui:repeat>
												
												</p:scrollPanel>
											</p:column>		           
										</p:dataTable>
									</div>
									<div class="ui-g-8">
										<iframe id="dcmpreview" src="" style="height:450px;width:100%;border:none;overflow:hidden;"></iframe>
										
									</div>
								</fieldset>
							</section>
						</div>
						</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.limitedFreeTextAnswer and coreCasePreviewForm.questionView}">
								<div class="ui-g-12 ui-md-12">
									<p:outputLabel for="answer" value="Límite de caracteres"
										style="font-size: 24px;" />
								</div>
								<div class="ui-g-12 ui-md-12">
									<p:outputLabel for="answer" value="#{coreCasePreviewForm.ccPreguntasFtaV1.limiteCaracteres}"
										style="font-size: 24px;" />
								</div>
								<div class="ui-g-12 ui-md-12">
									<p:outputLabel for="answer" value="Su Respuesta:"
										style="font-size: 24px;" />
									<p:inputTextarea id="answer" 
									maxlength="#{coreCasePreviewForm.ccPreguntasFtaV1.limiteCaracteres ==null ?600: coreCasePreviewForm.ccPreguntasFtaV1.limiteCaracteres}"
										onkeyup="value=specialCharacters(value)" required="true"
										value="#{coreCasePreviewForm.respuestaPreguntaCandidato}"
										rows="10" cols="50" style="width:98%;font-size: 24px;">
									</p:inputTextarea>
									<p:message for="answer" />
								</div>
							</h:panelGroup>
							<script type="text/javascript">
								//<![CDATA[ 
								function specialCharacters(input) {
									if (input == null)
										return input;
									var c = input.toLowerCase();									
									c = c.replace(new RegExp("[àáâãäå]", 'g'),
											"a");
									c = c.replace(new RegExp("æ", 'g'), "ae");
									c = c.replace(new RegExp("ç", 'g'), "c");
									c = c.replace(new RegExp("[èéêë]", 'g'),
											"e");
									c = c.replace(new RegExp("[ìíîï]", 'g'),
											"i");
									c = c.replace(new RegExp("[òóôõö]", 'g'),
											"o");
									c = c.replace(new RegExp("œ", 'g'), "oe");
									c = c.replace(new RegExp("[ùúûü]", 'g'),
											"u");
									c = c.replace(new RegExp("[ýÿ]", 'g'), "y");
									c = c.toUpperCase();
									return c;
								}
								//]]>
							</script>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.multipleChoice and coreCasePreviewForm.questionView and coreCasePreviewForm.singleAnswerMode}">
								<div class="ui-g-12 ui-md-12">
									<p:selectOneRadio id="answerRadioSingle"
										value="#{coreCasePreviewForm.respuestaPreguntaCandidato}"
										layout="grid" columns="1" required="true"
										requiredMessage="#{msgs['globalForm.requiredMessage']}"
										style="font-size: 24px;"
										 styleClass="grid-radio">
										<f:selectItems
											value="#{coreCasePreviewForm.listCcOpcionMultiple}" var="l"
											itemLabel="#{l.textoRespuesta}" itemValue="#{l.numero}" />
									</p:selectOneRadio>
									<p:message for="answerRadioSingle" />
								</div>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.multipleChoice and coreCasePreviewForm.questionView and not coreCasePreviewForm.singleAnswerMode}">
								<div class="ui-g-12 ui-md-12">
									<p:selectManyCheckbox id="answerRadioMultiple"
										value="#{coreCasePreviewForm.respuestasPreguntaCandidato}"
										layout="grid" columns="1" required="true"
										requiredMessage="#{msgs['globalForm.requiredMessage']}">
										<f:selectItems
											value="#{coreCasePreviewForm.listCcOpcionMultiple}" var="l"
											itemLabel="#{l.textoRespuesta}" itemValue="#{l.numero}" />
									</p:selectManyCheckbox>
									<p:message for="answerRadioMultiple" />
								</div>
							</h:panelGroup>
							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.answerView and coreCasePreviewForm.wrongAnswer and coreCasePreviewForm.limitedFreeTextAnswer}">
								<div class="ui-g-12 ui-md-12 xXwrongAnswer">Su Respuesta
									es INCORRECTA</div>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.answerView and coreCasePreviewForm.correctAnswer and coreCasePreviewForm.limitedFreeTextAnswer}">
								<div class="ui-g-12 ui-md-12 xXcorrectAnswer">Su Respuesta
									es CORRECTA</div>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.answerView}">
								<div class="ui-g-12 ui-md-12 xXscores">
									Puntuacíon:
									<h:outputText value="#{coreCasePreviewForm.puntuacion}" />
								</div>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.answerView and coreCasePreviewForm.wrongAnswer and coreCasePreviewForm.multipleChoice}">
								<div class="ui-g-12 ui-md-12 xXwrongAnswer">
									<h:outputText value="#{coreCasePreviewForm.correctAnswers}"
										style="color:green;" />
									<h:outputText value="&#160;y&#160;" style="color:black;" />
									<h:outputText value="#{coreCasePreviewForm.wrongAnswers}" />
								</div>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.answerView and coreCasePreviewForm.correctAnswer and coreCasePreviewForm.multipleChoice}">
								<div class="ui-g-12 ui-md-12 xXcorrectAnswer">
									<h:outputText value="#{coreCasePreviewForm.correctAnswers}" />
									<h:outputText value="&#160;y&#160;" style="color:black;" />
									<h:outputText value="#{coreCasePreviewForm.wrongAnswers}"
										style="color:red;" />
								</div>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.answerView and coreCasePreviewForm.limitedFreeTextAnswer}">
								<div class="ui-g-12 ui-md-12 xXinstructions">Usted
									contesto:</div>
								<div class="ui-g-12 ui-md-12 xXinstructions"
									style="color: green; font-weight: bold;">
									<p:outputLabel
										value="#{coreCasePreviewForm.respuestaPreguntaCandidato}" />
								</div>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.answerView and coreCasePreviewForm.limitedFreeTextAnswer}">
								<div class="ui-g-12 ui-md-12 xXinstructions">La respuesta
									correcta es:</div>
								<div class="ui-g-12 ui-md-12 xXinstructions"
									style="color: black; font-weight: bold;">
									<p:outputLabel
										value="#{coreCasePreviewForm.respuestaPreguntaSistema}" />
								</div>
								<div class="ui-g-12 ui-md-12 xXinstructions">
									<p:outputLabel
										rendered="#{coreCasePreviewForm.ccListaSinonimos.size()>0?true:false}"
										value="Sinónimos:" />
								</div>
								<ui:repeat var="ccSinonimo"
									value="#{coreCasePreviewForm.ccListaSinonimos}">
									<div class="ui-g-12 ui-md-12 xXinstructions">
										<p:outputLabel value="#{ccSinonimo.textoSinonimo}" />
									</div>
								</ui:repeat>
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{coreCasePreviewForm.multipleChoice and coreCasePreviewForm.answerView }">
								<div class="ui-g-8 ui-md-8 xXinstructions">
									<div class="ui-g-12 ui-md-12">
										<div class="ui-g-4 ui-md-4">
											<h:panelGroup layout="block">
												<h:outputText value="Correcta" />
											</h:panelGroup>
										</div>
										<div class="ui-g-4 ui-md-4">
											<h:panelGroup layout="block">
												<h:outputText value="Respuesta" />
											</h:panelGroup>
										</div>
										<div class="ui-g-4 ui-md-4">
											<h:panelGroup layout="block">
												<h:outputText value=" " />
											</h:panelGroup>
										</div>
									</div>
									<ui:repeat var="coreCaseOpcionMultiple"
										value="#{coreCasePreviewForm.listCcOpcionMultiple}">
										<div class="ui-g-12 ui-md-12">
											<h:panelGroup layout="block"
												rendered="#{coreCaseOpcionMultiple.estatus}">
												<div class="ui-g-4 ui-md-4">
													<div class="ui-inputgroup">
														<p:commandButton
															rendered="#{coreCaseOpcionMultiple.estatus}"
															icon="pi pi-check" styleClass="green-button" />
													</div>
												</div>
												<div class="ui-g-4 ui-md-4">
													<div class="ui-inputgroup">
														<h:outputText
															value="#{coreCaseOpcionMultiple.textoRespuesta}" />
													</div>
												</div>
												<div class="ui-g-4 ui-md-4">
													<h:outputText
														rendered="#{coreCaseOpcionMultiple.estatusCandidato}"
														value="Respuesta Seleccionada" />

												</div>
											</h:panelGroup>
											<h:panelGroup layout="block"
												rendered="#{not coreCaseOpcionMultiple.estatus}">
												<div class="ui-g-4 ui-md-4">
													<div class="ui-inputgroup">
														<p:commandButton icon="pi pi-times"
															styleClass="red-button" />
													</div>
												</div>
												<div class="ui-g-4 ui-md-4">
													<div class="ui-inputgroup">
														<h:outputText
															value="#{coreCaseOpcionMultiple.textoRespuesta}" />
													</div>
												</div>
												<div class="ui-g-4 ui-md-4">
													<h:outputText
														rendered="#{coreCaseOpcionMultiple.estatusCandidato}"
														value="Respuesta Seleccionada" />

												</div>
											</h:panelGroup>
										</div>
									</ui:repeat>
								</div>

							</h:panelGroup>
						</div>
					</div>
				</div>
				<div class="ui-g-12 ui-md-5">
					<p:commandButton value="Guardar y Procesar" update="coreCaseForm"
						actionListener="#{coreCasePreviewForm.saveProceed()}"
						rendered="#{coreCasePreviewForm.questionView}"
						style="margin-left:15px"
						oncomplete="handleUpdateRequest(xhr, status, args)" />
					<p:commandButton value="Saltar" style="margin-left:15px"
						immediate="true" action="#{coreCasePreviewForm.returnUpdateFta()}" />
					<p:commandButton value="Regresar" style="margin-left:15px"
						immediate="true" action="#{coreCasePreviewForm.returnUpdateFta()}" />
				</div>
			</div>


		</h:form>
	</ui:define>
</ui:composition>
