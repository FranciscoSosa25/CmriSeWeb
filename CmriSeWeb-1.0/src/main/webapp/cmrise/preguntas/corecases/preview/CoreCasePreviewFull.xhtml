<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<f:facet name="first">
		<link rel="shortcut icon" type="image/png"
			href="#{request.contextPath}/resources/poseidon-layout/images/login/cmri-120.png" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
	</f:facet>
	<style type="text/css">
header, footer {
	font-size: 20px;
	color: #fff;
	background-color: hsl(210, 89%, 17%);
	font-weight: bold;
	padding: 8px 15px 8px 15px;
	border-radius: 5px;
}

header, footer, main {
	margin: 10px 10px 10px 10px;
}

h1 {
	background-color: hsl(210, 99%, 27%);
	margin: 3px;
	border-radius: 5px;
	padding: 0px 0px 0px 8px;
}

h2 {
	color: black;
	font-weight: bold;
}

legend {
	font-size: 20px;
	font-weight: bold;
	color: black;
}

.ui-button {
	margin: 15px 30px 15px 30px;
}

.ui-button-text {
	font-size: 25px;
}

body {
	background-color: #D9E0E7;
}

label {
	font-weight: bold;
}
.canvas-container {
	position: relative;
}

.canvas-content {
	float: left;
	position: absolute;
	left: 0px;
	top: 0px;
	z-index: 98;
	background-color: transparent;
}
.dicom .ui-button-text{
	font-size : 15px !important;
}
.dicom .ui-button{
	margin: 2px !important;
}
.dicom .dicom-tile{
	height: 130px;
    overflow-y: scroll;
    border: #5f666c;
    box-sizing: border-box;
    border-style: solid;
    border-width: inherit;
}
</style>
</h:head>
<body>

	<header>
		<div>
			<h:outputText value="Candidato: #{userLogin.nombreCompletoUsuario}"
				style="position: relative; left:0px;" />
			<h:outputText value="Curp: #{userLogin.curp}"
				style="position: relative; left:300px;" />
		</div>
		<h1>Vista Previa</h1>
	</header>
	<h:outputStylesheet name="primeicons/primeicons.css"
		library="primefaces" />
	<h:form id="coreCaseForm">
		<div class="ui-g">
			<div class="ui-g-12 ui-md-12">
				<div class="ui-g-12 ui-md-12">
					<h:panelGroup
						rendered="#{!coreCasePreviewForm.visualizacionPregunta}">
						<div class="card">
							<section>
								<fieldset>
									<legend> Cuadro Clinico </legend>
									<h3>#{coreCasePreviewForm.ccHdrV1.historialClinico}</h3>
								</fieldset>
							</section>
						</div>
					</h:panelGroup>
				</div>
			</div>
			<div class="ui-g-12 ui-md-12 dicom">
				<div class="ui-g-12 ui-md-12">
					<h:panelGroup
						rendered="#{!coreCasePreviewForm.visualizacionPregunta and coreCasePreviewForm.listPresentCcImagenesGrp.size()>0}">
						
						<div class="card">
							<section>
								<fieldset>
									<legend>DICOM Series</legend>
									<div class="ui-g-4" >		
										 <p:dataTable var="imagenesGrupo"  value="#{coreCasePreviewForm.listPresentCcImagenesGrp}" 
										 	scrollable="true" scrollHeight="420">
			    
										  <p:column headerText="Series Title" style="width:60%; text-align: left;">
												<div class="ui-g-12" >		            	 	
													<h:outputText value="#{imagenesGrupo.tituloSuperior}" />
												</div>
												<div class="dicom dicom-tile" style="height: 130px">
													
												 <!-- <p:scrollPanel style=" width: 100%; height:130px;" styleClass="image-tile"> -->
													<ui:repeat var="imagenes"
														value="#{imagenesGrupo.listCcImagenes}" varStatus="status">
														<div class="image-tile" style="float: left;">
														<h:graphicImage
															value="data:image/jpg;base64,#{imagenes.thumbailBase64}"
															style="max-width: 250px; max-height: 300px; padding: 2px;"
															ajax="true"
															actionListener="#{coreCasePreviewForm.selCCImagenes(imagenes)}" 
															alt="#{imagenes.nombreImagen}" title="#{imagenes.nombreImagen}"
															
															/>
															 <p:commandButton icon="fa fa-edit" 
																oncomplete="polyModel.drawCanvas('paintingCanvas', 'canvas-container', 'coreCaseForm:imgHeight', 'coreCaseForm:imgWidth', 'coreCaseForm:cursorCor', 'coreCaseForm:respuestasPuntos')"
																ajax="true"
																process="@this"
																update="
																:coreCaseForm:canvas-image
																:coreCaseForm:numeroPoligonos
																:coreCaseForm:imgHeight
																:coreCaseForm:imgWidth
																:coreCaseForm:output
																:coreCaseForm:respuestasPuntos
																"
																actionListener="#{coreCasePreviewForm.selCCImagenes(imagenes)}"
															/>	
															</div>	
													</ui:repeat>
												<!-- </p:scrollPanel> -->
												</div>
												
											</p:column>		           
										</p:dataTable>
									</div>
									<div class="ui-g-8">
									
								<h:panelGroup layout="block" id="output"   rendered="true"> 	
									<div class="ui-g-12">
										
										<div class="ui-g-12 ui-md-8" style="text-align: left;">
											<p:inputText id="imgWidth"
												value="#{coreCasePreviewForm.selCcImagenes.width}"
												type="hidden" />
											<p:inputText id="imgHeight"
												value="#{coreCasePreviewForm.selCcImagenes.height}"
												type="hidden" />
											<p:inputText id="respuestasPuntos"
												value="#{coreCasePreviewForm.respuestasPuntos}"
												type="hidden" />	
											<p:inputText id="numeroPoligonos"
												value="#{coreCasePreviewForm.selCcImagenes.poligonos}"
												type="hidden" />
											<div id="canvas-container" class="canvas-container" style="visibility:visible;">	
												<div class="canvas-content">	
													<h:graphicImage id="canvas-image" style="display:none;"
																value="data:jpeg;base64,#{coreCasePreviewForm.selCcImagenes.jpgBase64}"
																>
    												</h:graphicImage>	
												</div>
											</div>
											<canvas  id="paintingCanvas"  style="cursor: crosshair; display: none;"
												onmousedown="polyModel.drawPoint(event, 'paintingCanvas', 'coreCaseForm:respuestasPuntos', 'coreCaseForm:numeroPoligonos')"
											>	</canvas>	
										</div>
										<div class="ui-g-12 ui-md-4">
											<div class="ui-g-12" style="text-align: right;">
												<p:inputText id="cursorCor"	value="" />
											</div>
											<div class="ui-g-12" style="text-align: right;">
												Poligonos : <h:outputText value="#{coreCasePreviewForm.selCcImagenes.poligonos}" />
											</div>
											<div class="ui-g-12" style="text-align: right;" >
												Punto Correctos : <h:outputText id="scorePoints" value="#{coreCasePreviewForm.selCcImagenes.puntoCorrectos}" />
											</div>
											<div class="ui-g-12" style="text-align: right;">
												<p:commandButton value="Puntos claros" type="button"
													onclick="polyModel.clearPoint('paintingCanvas', 'canvas-container',
															'coreCaseForm:imgHeight', 
															'coreCaseForm:imgWidth',
															'coreCaseForm:cursorCor', 
															'coreCaseForm:respuestasPuntos',
															'coreCaseForm:scorePoints')"
												 	style="background: #2d0d86;" />
												<p:commandButton value="Verify" 
													ajax="true"
													process="@this,respuestasPuntos"
													update=":coreCaseForm:scorePoints"
									                actionListener="#{coreCasePreviewForm.calculateScore(coreCasePreviewForm.selCcImagenes)}"
												 	style="background: #2d0d86;" />
											</div>
											<div class="ui-g-12" style="text-align: right;">
												 <p:commandButton value="Guardar puntos"
											  	   icon="fa fa-save"
						                           ajax="true"
						                           actionListener="#{coreCasePreviewForm.savePolygon()}"
						                           onstart="polyModel.save('presentationForm2:coordinates', 'presentationForm2:numeroPoligonos')"
						                           style="background: #2d0d86;" />	
											</div>
										</div>
									</div>
								</h:panelGroup>		
									</div>
								</fieldset>
							</section>
						</div>
					</h:panelGroup>
				</div>
			</div>
			<div class="ui-g-12 ui-md-12">
				<div class="ui-g-12 ui-md-12 ui-lg-7" style="text-align: center;">
					<h:panelGroup layout="block"
						rendered="#{coreCasePreviewForm.visualizacionPregunta}">
						<h1>#{coreCasePreviewForm.ccPreguntasFtaV1.tituloPregunta}?</h1>
						<h3>(#{coreCasePreviewForm.ccPreguntasFtaV1.textoSugerencias})</h3>
					</h:panelGroup>
				</div>
				<div class="ui-g-12 ui-md-12 ui-lg-12 dicom">
					<h:panelGroup layout="block"
						rendered="#{coreCasePreviewForm.visualizacionPregunta and coreCasePreviewForm.listPresentQCcImagenesGrp.size()>0}">
						
						<div class="card">
							<section>
								<fieldset>
									<legend>DICOM Series</legend>
									<div class="ui-g-4" >		
										 <p:dataTable var="imagenesGrupo"  value="#{coreCasePreviewForm.listPresentQCcImagenesGrp}" 
										 	scrollable="true" scrollHeight="420">
			    
										  <p:column headerText="Series Title" style="width:60%; text-align: left;">
												<div class="ui-g-12" >		            	 	
													<h:outputText value="#{imagenesGrupo.tituloSuperior}" />
												</div>
												<div class="dicom dicom-tile" style="height: 130px">
													
												 <!-- <p:scrollPanel style=" width: 100%; height:130px;" styleClass="image-tile"> -->
													<ui:repeat var="imagenes"
														value="#{imagenesGrupo.listCcImagenes}" varStatus="status">
														<div class="image-tile" style="float: left;">
														<h:graphicImage
															value="data:image/jpg;base64,#{imagenes.thumbailBase64}"
															style="max-width: 250px; max-height: 300px; padding: 2px;"
															ajax="true"
															actionListener="#{coreCasePreviewForm.selCCImagenes(imagenes)}" 
															alt="#{imagenes.nombreImagen}" title="#{imagenes.nombreImagen}"
															
															/>
															 <p:commandButton icon="fa fa-edit" 
																oncomplete="polyModel.drawCanvas('paintingCanvasQ', 'canvas-containerQ', 'coreCaseForm:imgHeightQ', 'coreCaseForm:imgWidthQ', 'coreCaseForm:cursorCorQ', 'coreCaseForm:respuestasPuntosQ')"
																ajax="true"
																process="@this"
																update="
																:coreCaseForm:canvas-imageQ
																:coreCaseForm:numeroPoligonosQ
																:coreCaseForm:imgHeightQ
																:coreCaseForm:imgWidthQ
																:coreCaseForm:outputQ
																:coreCaseForm:respuestasPuntosQ
																"
																actionListener="#{coreCasePreviewForm.selCCImagenes(imagenes)}"
															/>	
															</div>	
													</ui:repeat>
												<!-- </p:scrollPanel> -->
												</div>
												
											</p:column>		           
										</p:dataTable>
									</div>
									<div class="ui-g-8">
							<h:panelGroup layout="block" id="outputQ"   rendered="true"> 	
									<div class="ui-g-12">
										<div class="ui-g-12 ui-md-8" style="text-align: left;">
											<p:inputText id="imgWidthQ"
												value="#{coreCasePreviewForm.selCcImagenes.width}"
												type="hidden" />
											<p:inputText id="imgHeightQ"
												value="#{coreCasePreviewForm.selCcImagenes.height}"
												type="hidden" />
											<p:inputText id="respuestasPuntosQ"
												value="#{coreCasePreviewForm.respuestasPuntos}"
												type="hidden" />	
											<p:inputText id="numeroPoligonosQ"
												value="#{coreCasePreviewForm.selCcImagenes.poligonos}"
												type="hidden" />
											<div id="canvas-containerQ" class="canvas-container" style="visibility:visible;">	
												<div class="canvas-contenQt">	
													<h:graphicImage id="canvas-imageQ" style="display:none;"
																value="data:jpeg;base64,#{coreCasePreviewForm.selCcImagenes.jpgBase64}"
																>
    												</h:graphicImage>	
												</div>
											</div>
											<canvas  id="paintingCanvasQ"  style="cursor: crosshair; display: none;"
												onmousedown="polyModel.drawPoint(event, 'paintingCanvasQ', 'coreCaseForm:respuestasPuntosQ', 'coreCaseForm:numeroPoligonosQ')"
											>	</canvas>	
										</div>
										<div class="ui-g-12 ui-md-4">
											<div class="ui-g-12" style="text-align: right;">
												<p:inputText id="cursorCorQ"	value="" />
											</div>
											<div class="ui-g-12" style="text-align: right;">
												Poligonos : <h:outputText value="#{coreCasePreviewForm.selCcImagenes.poligonos}" />
											</div>
											<div class="ui-g-12" style="text-align: right;" >
												Punto Correctos : <h:outputText id="scorePointsQ" value="#{coreCasePreviewForm.selCcImagenes.puntoCorrectos}" />
											</div>
											<div class="ui-g-12" style="text-align: right;">
												<p:commandButton value="Puntos claros" type="button"
													onclick="polyModel.clearPoint('paintingCanvasQ', 'canvas-containerQ',
															'coreCaseForm:imgHeightQ', 
															'coreCaseForm:imgWidthQ',
															'coreCaseForm:cursorCorQ', 
															'coreCaseForm:respuestasPuntosQ',
															'coreCaseForm:scorePointsQ')"
												 	style="background: #2d0d86;" />
												<p:commandButton value="Verify" 
													ajax="true"
													process="@this,respuestasPuntosQ"
													update=":coreCaseForm:scorePointsQ"
									                actionListener="#{coreCasePreviewForm.calculateScore(coreCasePreviewForm.selCcImagenes)}"
												 	style="background: #2d0d86;" />
											</div>
											<div class="ui-g-12" style="text-align: right;">
												 <p:commandButton value="Guardar puntos"
											  	   icon="fa fa-save"
						                           ajax="true"
						                           actionListener="#{coreCasePreviewForm.savePolygon()}"
						                           style="background: #2d0d86;" />	
											</div>
										</div>
									</div>
								</h:panelGroup>
								</div>
								</fieldset>
							</section>
						</div>
					</h:panelGroup>
				</div>
			</div>
			<div class="ui-g-12 ui-md-12">
				<div class="ui-g-12 ui-md-12 ui-lg-7" style="text-align: center;">
					<ui:include
						src="/cmrise/preguntas/corecases/preview/CoreCasePreviewFullS.xhtml" />
				</div>
			</div>
			<div class="ui-g-12 ui-md-12">
				<div class="ui-g-12 ui-md-12 ui-lg-7" style="text-align: center;">
					<ui:include
						src="/cmrise/preguntas/corecases/preview/CoreCasePreviewFullText.xhtml" />
				</div>
			</div>
			<div class="ui-g-12 ui-md-12">
				<div class="ui-g-12 ui-md-12 ui-lg-8" style="text-align: center;">
					<ui:include
						src="/cmrise/preguntas/corecases/preview/CoreCasePreviewFullMultiple.xhtml" />
				</div>
			</div>
			<div class="ui-g-12 ui-md-5">
				<p:commandButton value="Siguiente"
					action="#{coreCasePreviewForm.verPregunta()}" immediate="true"
					update="@form" style="margin-left:15px; background: #2d0d86;" />
				<p:commandButton value="Regresar"
					style="margin-left:15px; background: #2d0d86;" immediate="true"
					update="@form" action="#{coreCasePreviewForm.returnUpdate()}" />
				<p:commandButton value="Calificar"
					style="margin-left:15px; background: #2d0d86;"
					rendered="#{coreCasePreviewForm.visualizacionPregunta  and  coreCasePreviewForm.questionView }"
					action="#{coreCasePreviewForm.calificar()}" update="@form" />
			</div>

		</div>
		<footer>
			<h:outputText value="Consejo Mexicano de Radiología e Imagen A.C." />
			<h:outputText style="position: relative; left:150px;">
				<f:convertDateTime type="date" pattern="dd-MM-yyyy" />
			</h:outputText>
			<h:outputText
				value="&amp;copy; Todos los Derechos Reservados Año 2020"
				escape="false" style="position: relative; left:400px;" />
		</footer>
	</h:form>
</body>

</html>
